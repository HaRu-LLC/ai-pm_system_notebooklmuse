# Privacy Email Review リファレンス

メール取得機能のプライバシー設計レビューの詳細チェックリスト。

---

## 目次

1. [目的の正当化](#1-目的の正当化)
2. [同意（オプトイン）](#2-同意オプトイン)
3. [取得最小化](#3-取得最小化)
4. [露出経路遮断](#4-露出経路遮断)
5. [保存と保護](#5-保存と保護)
6. [保持と削除](#6-保持と削除)
7. [インシデント対応](#7-インシデント対応)
8. [実装チェックリスト](#8-実装チェックリスト)

---

## 1. 目的の正当化

- [ ] メール取得が本当に必要か？
- [ ] 代替手段（匿名ID、ワンタイムコード等）で代替できないか？
- [ ] 目的が明確で、オーバーコレクションになっていないか？
- [ ] 「なぜメールが必要か」を一言で説明できるか？

**よくある代替手段**:
| 目的 | 代替手段 |
|------|----------|
| 結果通知 | ダウンロードリンク、QRコード |
| ログイン | OAuth、パスキー |
| 連絡 | アプリ内通知 |

---

## 2. 同意（オプトイン）

- [ ] 同意文言はユーザーに理解しやすいか？
- [ ] 専門用語を避け、平易な言葉で説明されているか？
- [ ] プライバシーポリシー/通知へのリンクがあるか？
- [ ] チェックボックス等で明示的同意を取得しているか？
- [ ] デフォルトでオプトアウト状態になっているか？
- [ ] 二重同意（ダブルオプトイン）が必要なケースか？
  - マーケティング目的
  - メールマガジン登録
  - 第三者への提供

---

## 3. 取得最小化

- [ ] フォーム項目は最小限か？
- [ ] メール以外に不要な項目がないか？
- [ ] オプション項目と必須項目は明確に区別されているか？
- [ ] 「あると便利」程度の項目は削除したか？

---

## 4. 露出経路遮断

### URL
- [ ] URLクエリパラメータにメールを載せていないか？
- [ ] リダイレクトURLにメールが含まれていないか？

### ログ
- [ ] アプリケーションログにメールがマスクなしで出力されていないか？
- [ ] アクセスログにメールが含まれていないか？
- [ ] デバッグログにメールが露出していないか？

### エラー・通知
- [ ] エラー画面にメールが表示されていないか？
- [ ] エラー通知（Slack等）にメールが含まれていないか？
- [ ] スタックトレースにメールが露出していないか？

### 分析ツール
- [ ] Google Analytics等にメールがそのまま送信されていないか？
- [ ] ヒートマップツールにメールが記録されていないか？

---

## 5. 保存と保護

### 分離保管
- [ ] メールは他のデータと分離して保管されているか？
- [ ] PIIテーブルは専用DBまたは専用スキーマに配置されているか？

### 暗号化
- [ ] 保存時暗号化（at rest）が有効か？
- [ ] 通信時暗号化（in transit / HTTPS）が有効か？
- [ ] 暗号化キーは適切に管理されているか？

### アクセス制御
- [ ] 誰がメールにアクセスできるか明確か？
- [ ] 最小権限の原則が適用されているか？
- [ ] アクセスログが記録されているか？

---

## 6. 保持と削除

### 保持期間
- [ ] 保持期間が明確に決まっているか？
- [ ] 保持期間は目的達成に必要な最小限か？
- [ ] 保持期間経過後の自動削除が実装されているか？

### 削除手順
- [ ] 削除手順が文書化されているか？
- [ ] 削除は完全削除か（論理削除ではなく）？
- [ ] バックアップからも削除されるか？

### ユーザー権利
- [ ] ユーザーからの削除依頼への導線があるか？
- [ ] 削除依頼への対応期限が決まっているか？
- [ ] 削除完了通知の仕組みがあるか？

---

## 7. インシデント対応

- [ ] 漏えい時の対応手順が（最小限でも）記載されているか？
- [ ] 報告先（社内）が明確か？
- [ ] 報告先（監督官庁）が把握されているか？
- [ ] ユーザーへの通知手順があるか？
- [ ] 対応タイムラインが決まっているか？

---

## 8. 実装チェックリスト

### HTTPメソッド
```
✅ POST /api/register { email: "..." }
❌ GET /api/register?email=user@example.com
```

### ログマスク
```
✅ INFO: User registered: ***@***
❌ INFO: User registered: user@example.com
```

### DBスキーマ
```sql
-- ✅ PIIテーブル分離
CREATE TABLE pii.user_emails (
  user_id UUID PRIMARY KEY,
  email_encrypted BYTEA NOT NULL
);

-- ❌ 通常テーブルに平文保存
CREATE TABLE users (
  email VARCHAR(255) NOT NULL
);
```

### エラーハンドリング
```
✅ "登録に失敗しました。再度お試しください。"
❌ "user@example.com の登録に失敗しました。"
```

---

## 関連ドキュメント

| ドキュメント | 内容 |
|--------------|------|
| [SKILL.md](./SKILL.md) | メイン定義 |
| [Workflow](../../workflows/05_meta_privacy_review_email.md) | 元ワークフロー |
