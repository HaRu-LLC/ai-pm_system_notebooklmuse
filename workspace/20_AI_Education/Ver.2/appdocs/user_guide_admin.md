# 管理者ガイド

- プロジェクト名: AIポリテラシー育成プログラム Ver.2
- 対象: 管理者（admin）
- 作成日: 2026-01-05
- 版: v1.1（コホート管理機能追加）

---

## はじめに

このガイドでは、管理者として本プログラムのシステムを運用する際の操作方法を説明します。
管理者は、ユーザー管理、受講者グループ管理、システム設定、データエクスポートなどの権限を持ちます。

---

## 1. 管理者の権限

### 1.1 権限一覧

| 機能 | learner | instructor | admin |
|---|:---:|:---:|:---:|
| 自分のダッシュボード | ✓ | ✓ | ✓ |
| 全受講者一覧 | - | ✓ | ✓ |
| 全受講者進捗閲覧 | - | ✓ | ✓ |
| 手動評価入力 | - | ✓ | ✓ |
| レポート出力 | - | ✓ | ✓ |
| **受講者招待** | - | - | ✓ |
| **ユーザー管理** | - | - | ✓ |
| **受講者グループ管理** | - | - | ✓ |
| **セッション・課題管理** | - | - | ✓ |
| **システム設定** | - | - | ✓ |
| **助成金レポート出力** | - | - | ✓ |

---

## 2. ユーザー管理

### 2.1 ユーザー一覧

1. 左メニューから「管理」→「ユーザー管理」をクリック
2. 全ユーザーの一覧が表示されます

**一覧項目**:

| 項目 | 説明 |
|---|---|
| 氏名 | ユーザー名 |
| メールアドレス | ログインID |
| ロール | learner / instructor / admin |
| 所属 | 企業名（organization） |
| ステータス | アクティブ / 停止 / 招待中 |
| 登録日 | アカウント作成日 |

### 2.2 受講者の招待

**個別招待**:

1. 「ユーザー管理」画面で「新規招待」をクリック
2. 以下の情報を入力：
   - メールアドレス（必須）
   - 氏名（必須）
   - ロール（デフォルト: learner）
   - 所属（企業名、必須）
3. 「招待を送信」をクリック
4. 招待メールが自動送信されます

**一括招待（CSV）**:

1. 「一括招待」をクリック
2. CSVテンプレートをダウンロード
3. 以下の形式でデータを作成：

```csv
email,name,role,organization
yamada@example.com,山田太郎,learner,株式会社サンプル
suzuki@example.com,鈴木花子,learner,株式会社サンプル
```

4. CSVファイルをアップロード
5. プレビューを確認し、「招待を実行」

### 2.3 ユーザー編集

1. ユーザー一覧から編集したいユーザーをクリック
2. 「編集」ボタンをクリック
3. 以下の項目を編集可能：
   - 氏名
   - ロール
   - 所属（organization）
   - ステータス（アクティブ/停止）
4. 「保存」をクリック

### 2.4 パスワードリセット

1. ユーザー詳細画面で「パスワードリセット」をクリック
2. 確認ダイアログで「はい」を選択
3. ユーザーにリセットメールが送信されます

### 2.5 ユーザー停止・削除

**停止**（ログイン不可、データ保持）:
1. ユーザー詳細画面で「アカウント停止」をクリック
2. 停止理由を選択
3. 「停止」をクリック

**削除**（論理削除、データは保持期間まで保持）:
1. ユーザー詳細画面で「削除」をクリック
2. 確認ダイアログで削除理由を入力
3. 「削除を実行」をクリック

> **注意**: 助成金対応のため、5年間はデータが保持されます。

---

## 3. コホート管理（期別・企業別）

### 3.1 コホートとは

コホートは、期別・企業別に受講者をグループ化する単位です。各コホートには以下の情報が設定されます：

| 項目 | 説明 | 例 |
|---|---|---|
| コホート名 | グループの識別名 | 第1期（2026年4月開講） |
| 企業名 | 所属企業 | 株式会社サンプル |
| 開講日 | 研修開始日 | 2026-04-01 |
| 修了予定日 | 研修終了日 | 2026-06-30 |
| ステータス | active / completed / cancelled | active |

### 3.2 コホート一覧

1. 「管理」→「コホート管理」をクリック
2. 全コホートが一覧表示されます

**フィルタ項目**:

| 項目 | 説明 |
|---|---|
| ステータス | active / completed / cancelled |
| 企業名 | 企業名でフィルタ |

### 3.3 コホート作成

1. 「コホート管理」画面で「新規作成」をクリック
2. 以下の情報を入力：
   - コホート名（必須）
   - 企業名（必須）
   - 開講日（必須）
   - 修了予定日（必須）
   - 説明（任意）
   - 最大参加者数（任意）
3. 「作成」をクリック

### 3.4 受講者のコホート割当

**招待時に割当**:
1. 受講者招待時にコホートを選択

**既存受講者の割当**:
1. コホート詳細画面で「メンバー追加」をクリック
2. 受講者を選択（複数選択可）
3. 「追加」をクリック

> **注意**: 1受講者は1コホートにのみ所属できます。既に他コホートに所属している場合はエラーになります。

### 3.5 コホート別レポート

コホート単位でレポート出力が可能です：

1. 「管理」→「助成金レポート」をクリック
2. 「コホート」フィルタで対象を絞り込み
3. 「エクスポート」をクリック

---

## 4. セッション・課題管理

### 4.1 セッション管理

1. 「管理」→「セッション管理」をクリック
2. 全12セッションが表示されます

**設定可能項目**:

| 項目 | 説明 |
|---|---|
| セッション名 | タイトル |
| 動画URL | Part 1 / Part 2 のURL |
| 公開状態 | 公開 / 非公開 / スケジュール公開 |
| 公開日時 | スケジュール公開の場合の日時 |

### 4.2 課題管理

1. 「管理」→「課題管理」をクリック
2. 全24課題が表示されます

**設定可能項目**:

| 項目 | 説明 |
|---|---|
| 課題名 | タイトル |
| 説明文 | 課題の説明（Markdown対応） |
| 必須/任意 | 修了要件に含めるか |
| 標準時間 | 取り組み目安時間（助成金計算用） |
| 評価ルーブリック | 評価項目と配点 |

### 4.3 評価プロンプトの編集

> **注意**: 評価プロンプトの変更は評価品質に影響します。変更前にテスト評価を実施してください。

1. 課題詳細画面で「評価設定」タブをクリック
2. 評価プロンプトテンプレートを編集
3. 「テスト評価」でサンプル提出物に対する評価を確認
4. 問題なければ「保存」をクリック

---

## 5. 最終発表参加の記録

### 5.1 参加記録の登録

最終発表に参加した受講者の記録を登録します。

1. 「管理」→「最終発表管理」をクリック
2. 対象企業（organization）を選択
3. 発表日を選択
4. 参加した受講者にチェックを入れる
5. 「参加を記録」をクリック

### 5.2 API経由での登録

```http
POST /admin/learners/{user_id}/final-presentation

Request:
{
  "attended_at": "2026-03-28T14:00:00+09:00"
}

Response:
{
  "success": true,
  "user_id": "xxx",
  "final_presentation_attended_at": "2026-03-28T14:00:00+09:00"
}
```

---

## 6. 修了証発行

### 6.1 修了要件の確認

修了証発行前に、以下の要件を確認します：

| 要件 | 条件 |
|---|---|
| 動画視聴 | 12セッション × 2パート = 24本完了 |
| 必須課題 | 12課題すべて提出 |
| 最終発表 | 参加記録あり |

### 6.2 修了証発行手順

1. 「管理」→「修了証管理」をクリック
2. 対象企業（organization）を選択
3. 修了要件達成者が一覧表示されます
4. 発行対象者にチェックを入れる
5. 「修了証を発行」をクリック
6. PDF生成とメール送信が実行されます

### 6.3 個別発行

1. ユーザー詳細画面で「修了証」タブをクリック
2. 「修了証を発行」をクリック
3. 発行日、証書番号を確認
4. 「発行」をクリック

---

## 7. 助成金レポート出力

### 7.1 利用可能なレポート

| レポート | 説明 | 用途 |
|---|---|---|
| 受講者名簿 | 登録受講者の一覧 | 訓練計画書添付 |
| 視聴証跡 | 動画視聴の詳細ログ | 出席証明 |
| 課題提出証跡 | 課題提出の詳細ログ | 学習証明 |
| ミーティング参加証跡 | Zoom参加記録 | 出席証明 |
| 学習時間集計 | 総学習時間の計算 | 訓練実施報告 |
| 修了者名簿 | 修了者リスト | 訓練修了報告 |

### 7.2 エクスポート手順

1. 「管理」→「助成金レポート」をクリック
2. レポート種別を選択
3. 対象企業・期間を指定
4. 「エクスポート」をクリック
5. CSV/PDFがダウンロードされます

### 7.3 一括エクスポート

1. 「全証跡一括エクスポート」をクリック
2. 対象企業（organization）を選択
3. 「ZIPでダウンロード」をクリック
4. 全レポートがZIPファイルでダウンロードされます

---

## 8. システム設定

### 8.1 一般設定

| 設定項目 | 説明 |
|---|---|
| サイト名 | アプリのタイトル |
| ロゴ画像 | ヘッダーに表示するロゴ |
| 問い合わせ先 | サポートメールアドレス |
| タイムゾーン | デフォルト: Asia/Tokyo |

### 8.2 通知設定

| 設定項目 | 説明 |
|---|---|
| 評価完了通知 | 有効/無効 |
| 視聴リマインド | 送信曜日・時刻 |
| 課題リマインド | 送信曜日・時刻 |
| 週次サマリー | 講師向け週次レポートの送信 |

### 8.3 評価設定

| 設定項目 | 説明 |
|---|---|
| 自動評価モデル | gemini-1.5-flash（デフォルト） |
| 評価タイムアウト | 最大待機時間 |
| リトライ回数 | エラー時のリトライ数 |
| フォールバック | 失敗時の手動評価への切り替え |

### 8.4 セキュリティ設定

| 設定項目 | 説明 |
|---|---|
| パスワードポリシー | 最小文字数、複雑性要件 |
| セッションタイムアウト | 自動ログアウトまでの時間 |
| ログイン試行制限 | 失敗回数によるロック |

---

## 9. 監査ログ

### 9.1 監査ログの確認

1. 「管理」→「監査ログ」をクリック
2. 操作履歴が時系列で表示されます

**記録される操作**:

| 操作カテゴリ | 例 |
|---|---|
| 認証 | ログイン、ログアウト、パスワード変更 |
| ユーザー管理 | 招待、編集、削除 |
| 評価 | 手動評価の入力 |
| エクスポート | レポートのダウンロード |
| 設定変更 | システム設定の変更 |

### 9.2 ログのフィルタリング

- 日付範囲
- 操作カテゴリ
- 操作者
- 対象ユーザー

### 9.3 ログのエクスポート

1. フィルタを設定
2. 「エクスポート」をクリック
3. CSVファイルがダウンロードされます

---

## 10. トラブルシューティング

### 10.1 よくある問題と対応

| 問題 | 原因 | 対応 |
|---|---|---|
| 招待メールが届かない | メールアドレス誤り/迷惑メール | アドレス確認、再送信 |
| 自動評価が完了しない | API障害/タイムアウト | 手動評価に切り替え |
| ユーザーがログインできない | パスワード忘れ/アカウント停止 | パスワードリセット/停止解除 |
| レポートが出力できない | 対象データなし/システムエラー | データ確認、再試行 |

### 10.2 Gemini API評価エラーの対応

1. 「管理」→「評価管理」→「エラー一覧」で確認
2. エラー内容を確認（レート制限、コンテンツフィルター等）
3. 再評価を試みる、または手動評価に切り替え

### 10.3 サポートへの連絡

システムに関する問題は、以下に連絡してください：

- 技術サポート: tech-support@example.com
- 緊急連絡先: 講師直通

---

## 11. バックアップと復旧

### 11.1 自動バックアップ

Supabaseにより以下のバックアップが自動実行されます：

| 種別 | 頻度 | 保持期間 |
|---|---|---|
| 日次バックアップ | 毎日 3:00 JST | 7日間 |
| 週次バックアップ | 毎週日曜 | 30日間 |

### 11.2 手動バックアップ

重要な作業前には手動バックアップを推奨します：

1. Supabase Dashboard にアクセス
2. Settings → Database → Backups
3. 「Create Backup」をクリック

### 11.3 復旧手順

復旧が必要な場合は、技術サポートに連絡してください。

---

## 更新履歴

| 日付 | バージョン | 変更内容 |
|---|---|---|
| 2026-01-05 | v1.0 | 初版作成 |
