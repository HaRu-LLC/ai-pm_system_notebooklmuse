# 要件定義書

- プロジェクト名: AIポリテラシー育成プログラム Ver.2
- 更新日: 2026-01-03
- 版: v2.0（専用Webアプリ化・Gemini API採用）
- 関連文書: OverallProjectCharter.md (v2.0), ../appdocs/app_spec.md, ../appdocs/db_schema.md, ../appdocs/api_spec.md
- 設計方針: **案3-A採用**（課題提出・ダッシュボード専用Webアプリ化）

---

## 1. 業務要件

### 1.1 ビジネス目標

> **企業内で生成AIを使いこなし、組織に貢献できる人材を育成する**

- HaRu「領域2: AI × 教育・人材育成」サービスとして展開
- 13週間198,000円の研修プログラムを確立
- 厚労省助成金スキーム対応による導入障壁の低減

### 1.2 業務要件一覧

| ID | 要件 | 優先度 | 根拠 | 検証方法 |
|---|---|---|---|---|
| BR-01 | 3タイプ（A/B/C）の受講者全員がゴール到達できる設計 | 高 | ターゲット多様性への対応 | 修了率・成果物評価 |
| BR-02 | 動画完走率80%以上を達成 | 高 | KPI目標 | Webアプリ視聴チェックイン分析 |
| BR-03 | 必須課題提出率100%を達成 | 高 | KPI目標（修了要件） | Webアプリ提出管理 |
| BR-04 | 受講満足度4.0/5.0以上を達成 | 高 | KPI目標 | アンケート集計 |
| BR-05 | 3ヶ月後定着率70%以上を達成 | 中 | KPI目標 | フォローアップ調査 |
| BR-06 | 厚労省助成金申請に必要な要件を満たす | 高 | 価格競争力確保 | 助成金申請承認 |
| BR-07 | 外部混在（企業/個人/学生）で受講可能 | 高 | 商品拡販 | 多様なユーザー受け入れ |

---

## 2. 機能要件

### 2.1 機能一覧（コンテンツ配信）

| ID | 機能名 | 説明 | 優先度 | 受け入れ基準 |
|---|---|---|---|---|
| FR-01 | 動画配信 | YouTube/Vimeo限定公開で週約40分（2パート構成）を配信 | P0 | 全13セッション分（Session 0含む12セッション＋最終課題）の動画が視聴可能 |
| FR-02 | コンテンツポータル | Google Sites等で動画・課題へのリンク集を提供 | P1 | 受講者がログイン不要で教材にアクセス可能 |
| FR-03 | グループミーティング | 隔週60分のZoomミーティング | P1 | 8回のミーティングを実施・録画可能 |
| FR-04 | GPTs/ツール提供 | 受講者向けカスタムGPTs提供 | P1 | 各Phase対応のGPTsが利用可能 |
| FR-05 | LP・募集ページ | 研修概要・申込機能を持つWebページ | P1 | 個人・企業が申込完了まで可能 |
| FR-06 | 決済システム | Stripe連携によるオンライン決済 | P2 | 個人受講者がカード決済可能 |
| FR-07 | 請求書発行 | 企業導入向け請求書払い対応 | P2 | 請求書PDF発行・送付が可能 |

### 2.2 機能一覧（専用Webアプリ：MVP）

> [!IMPORTANT]
> 以下はコア機能として専用Webアプリで実装する（Google Apps依存からの脱却）

| ID | 機能名 | 説明 | 優先度 | 受け入れ基準 |
|---|---|---|---|---|
| FR-10 | ログイン/アカウント管理 | メール+パスワード認証、ロール（受講者/講師/管理者） | P0 | 外部混在でも登録・ログイン可能 |
| FR-11 | コホート管理 | 期/企業/グループ単位でのユーザー管理 | P0 | 企業別・期別にデータ分離可能 |
| FR-12 | 課題一覧/提出 | Session/必須/任意の課題表示、テキスト/URL/ファイル提出 | P0 | 全13必須課題+任意課題が提出可能 |
| FR-13 | 自動評価（Gemini API） | 提出物をLLM自動評価、JSON形式でスコア・コメント返却 | P0 | 提出後10分以内に評価結果表示 |
| FR-14 | 個人ダッシュボード | 自分の進捗・評価結果・未提出課題を表示 | P0 | 受講者は自分のデータのみ閲覧可能 |
| FR-15 | 管理者ダッシュボード | 全体進捗・フィルタ・CSV出力・未提出者抽出 | P0 | 管理者が全受講者の進捗を確認可能 |
| FR-16 | 視聴チェックイン | セッション単位で視聴完了を報告（助成金証跡） | P0 | 視聴ログがDB保存・エクスポート可能 |
| FR-17 | 受講者規約表示/同意 | 自動評価・入力禁止情報の同意取得 | P0 | 初回ログイン時に同意必須 |
| FR-18 | 通知（メール） | 評価完了・リマインド・お知らせをメール送信 | P1 | 評価完了時に自動通知 |
| FR-19 | 監査ログ/エクスポート | 操作ログ記録、助成金用データCSVエクスポート | P1 | 助成金監査に必要な証跡を出力可能 |

### 2.3 ユースケース

#### UC-01: 動画視聴→チェックイン

- **アクター**: 受講者
- **前提条件**: 受講アカウント発行済み、該当週の動画が公開済み
- **フロー**:
  1. 受講者がコンテンツポータル（Google Sites）にアクセス
  2. 該当セッションの動画リンクをクリック（YouTube/Vimeo）
  3. 動画を視聴
  4. **Webアプリにログインし、視聴チェックインを実行**
  5. チェックインがDBに記録される
- **期待結果**: 視聴完了ログが記録され、個人ダッシュボードに反映される

#### UC-02: 課題提出→自動評価

- **アクター**: 受講者
- **前提条件**: Webアプリにログイン済み
- **フロー**:
  1. 受講者がWebアプリの課題一覧にアクセス
  2. 該当課題を選択し、課題内容を確認
  3. 成果物（テキスト/URL/ファイル）を入力・添付
  4. 提出ボタンをクリック
  5. **Gemini APIで自動評価が実行される**（バックグラウンド）
  6. 評価完了通知がメールで届く
  7. 個人ダッシュボードでスコア・コメントを確認
- **期待結果**: 提出物が保存され、10分以内に評価結果が表示される

#### UC-03: 企業申込→アカウント発行

- **アクター**: 企業担当者、運営
- **前提条件**: LP閲覧、導入検討済み
- **フロー**:
  1. 企業担当者がLPの企業向け申込フォームにアクセス
  2. 会社情報・受講者人数・希望開始時期を入力
  3. 申込送信
  4. 営業担当から連絡、請求書発行
  5. 入金確認後、**運営がWebアプリでコホート・ユーザーを一括登録**
  6. 受講者にアカウント発行メールが届く
- **期待結果**: 企業受講者がメール+パスワードでログイン可能

---

## 3. 非機能要件

### 3.1 性能要件

- **応答時間**: ページ表示3秒以内、動画再生開始5秒以内
- **処理能力**: 同時動画視聴50ユーザー
- **同時ユーザー数**: 100名（1クラス最大想定）

### 3.2 セキュリティ要件

- **認証**: メールアドレス＋パスワード認証（SSO対応検討）
- **認可**: 受講者/管理者/講師の3ロール
- **データ保護**:
  - 個人情報はSSL/TLS暗号化通信
  - 決済情報はStripeに委託（PCI DSS準拠）
  - 成果物データは受講者本人と管理者のみアクセス可

### 3.3 情報セキュリティガイドライン（受講者向け）

> [!IMPORTANT]
> Phase4（業務解体・ROI試算）では業務情報を扱うため、以下のガイドラインを必須とする

- **入力禁止情報**:
  - 社外秘・機密情報
  - 個人情報（氏名、連絡先、マイナンバー等）
  - 顧客情報・取引先情報
  - パスワード・認証情報
- **匿名化ルール**:
  - 企業名 → 「A社」「B社」
  - 人名 → 「担当者X」「部長Y」
  - 金額 → 概算またはダミー数値
- **受講者確認事項**:
  - [ ] 所属企業のAI利用規定を確認済み
  - [ ] 入力禁止情報を理解済み
  - [ ] 課題提出前に匿名化チェック実施

### 3.4 可用性・信頼性

- **稼働率**: 99%（月間ダウンタイム7.2時間以内）
- **MTBF**: 720時間以上
- **MTTR**: 4時間以内
- **バックアップ**: 日次自動バックアップ、30日保持

### 3.5 保守性・拡張性

- **保守性**: 動画コンテンツの差し替えが管理画面から可能
- **拡張性**: 受講者数増加時にスケールアウト可能な構成

---

## 4. 制約条件

### 4.1 スケジュール制約（確定版）

| マイルストーン | 日付 | 備考 |
|---|---|---|
| **募集開始** | 2026-02-01 | LP公開、申込受付開始 |
| **Phase1動画完成** | 2026-02-15 | Session 1-3（開講2週間前） |
| **開講日（第1期）** | 2026-03-01 | Week 1開始 |
| **Phase2動画完成** | 2026-03-15 | Session 4-5（Week 3までに） |
| **Phase3動画完成** | 2026-04-15 | Session 6-10（Week 7までに） |
| **Phase4動画完成** | 2026-05-01 | Session 11-13（Week 10までに） |
| **修了式** | 2026-05-31 | Week 13 |

> **動画制作方針**: Phase1（Session 1-3）は開講前に完成必須。Phase2-4は開講後に順次制作し、該当週の2週間前までに完成させる。

### 4.2 技術制約

- 動画配信は既存プラットフォーム（Vimeo/YouTube限定公開等）を活用
- GPTsはOpenAI ChatGPT Plus/Team/Enterprise環境前提

### 4.3 予算制約

- 初期開発費用は最小限（既存ツール活用優先）
- 月額運用コストは受講者1人あたり収益の20%以内

### 4.4 リソース制約

- 講師1名（井戸）がメイン、サポート要員1名
- 動画編集は外注または自動化ツール活用
- **評価運用**: 週200件（100名×2課題）の評価を2名体制で回す必要あり（自動採点必須）

---

## 5. システム/ツール選定

### 5.1 システム構成方針（専用Webアプリ＋外部コンテンツ）

> [!IMPORTANT]
> **案3-A採用**: 課題提出・ダッシュボード・視聴チェックインは**専用Webアプリ**で実装。
> 動画配信はYouTube/Vimeo、コンテンツポータルはGoogle Sites（補助的利用）。

- **方針**: コア機能をWebアプリ化し、外部混在・継続商品に対応
- **理由**:
  - Googleアカウント前提を外し、企業/個人/学生の混在に対応
  - 受講者間のデータ分離（RLS）を確実に実装
  - コホート増加時の運用スケーラビリティ確保

**システム境界**:

| 領域 | Webアプリ | 外部サービス |
|---|:---:|:---:|
| ログイン/アカウント | ✓ | - |
| 課題提出 | ✓ | - |
| 自動評価（Gemini） | ✓ | - |
| 進捗ダッシュボード | ✓ | - |
| 視聴チェックイン | ✓ | - |
| 動画配信 | - | YouTube/Vimeo |
| コンテンツリンク集 | - | Google Sites |
| ミーティング | - | Zoom |
| 決済 | - | Stripe |

### 5.2 ツール選定

| ツール | 用途 | 選定理由 |
|---|---|---|
| **専用Webアプリ** | 課題提出・評価・ダッシュボード | コア機能の一元管理、RLS実装 |
| **Gemini API** | LLM評価 | 課題自動評価（コスト効率重視） |
| YouTube/Vimeo | 動画配信 | 限定公開対応、埋め込み容易 |
| Google Sites | コンテンツポータル | 動画リンク集・カリキュラム表示（ログイン不要） |
| Zoom | ミーティング | 録画・アーカイブ機能 |
| Stripe | 決済 | 個人向けカード決済 |
| ChatGPT (GPTs) | 学習支援ツール | カスタムGPTs構築の教材そのもの |
| SendGrid/AWS SES | メール通知 | 評価完了・リマインド送信 |

### 5.3 コンテンツポータル構成（Google Sites）

> **役割**: 動画・教材へのリンク集（ログイン不要）。課題提出はWebアプリへ誘導。

```
Google Sites（コンテンツポータル）
├── トップページ（お知らせ、Webアプリへのリンク）
├── カリキュラム
│   ├── Phase 1
│   │   ├── Session 1（YouTube埋め込み、Webアプリ課題リンク）
│   │   ├── Session 2
│   │   └── Session 3
│   ├── Phase 2-4（同様）
├── FAQ・よくある質問
└── ミーティングアーカイブ（YouTube限定公開）
```

### 5.4 データフロー（Webアプリ中心）

```
[受講者]
    │
    ▼ ログイン（メール+パスワード）
[Webアプリ]
    │
    ├─[課題提出]─→ [DB: submissions]
    │                   │
    │                   ▼ (非同期ジョブ)
    │              [Gemini API呼び出し]
    │                   │
    │                   ▼
    │              [DB: evaluations]
    │                   │
    │                   ▼
    │              [メール通知（評価完了）]
    │
    ├─[視聴チェックイン]─→ [DB: view_checkins]
    │
    └─[ダッシュボード]─→ [DB から集計表示]
```

### 5.5 Gemini API評価実装方式

> [!IMPORTANT]
> **Gemini API**を使用。コスト効率とGoogle Cloud統合を重視。

**技術仕様**:

| 項目 | 内容 |
|---|---|
| API | Gemini API (gemini-1.5-flash推奨) |
| 呼び出し元 | Webアプリバックエンド（非同期ジョブ） |
| 認証情報 | 環境変数（サーバーサイド） |
| 入力 | 受講者の課題回答（匿名化チェック済み） |
| 出力 | JSON形式（スコア・内訳・コメント） |
| リトライ | 3回まで自動リトライ（指数バックオフ） |
| 障害時 | 手動評価キューに追加、講師に通知 |
| コスト上限 | 月額$30（約500-1000件評価想定） |

**評価出力スキーマ（JSON）**:

```json
{
  "score": 85,
  "breakdown": {
    "elements": 22,
    "practicality": 21,
    "creativity": 20,
    "completeness": 22
  },
  "good_points": ["4要素が明確に構成されている", "業務シーンが具体的"],
  "improvements": ["制約条件をもう少し具体的に"],
  "next_step": "次はペルソナ設定を加えてみましょう"
}
```

**必須フィールド**:

| フィールド | 型 | 説明 |
|---|---|---|
| `score` | number | 総合スコア（0-100） |
| `breakdown.elements` | number | 4要素の充足度（0-25） |
| `breakdown.practicality` | number | 実践性（0-25） |
| `breakdown.creativity` | number | 創意工夫（0-25） |
| `breakdown.completeness` | number | 完成度（0-25） |
| `good_points` | string[] | 良かった点（1-3項目） |
| `improvements` | string[] | 改善のアドバイス（1-3項目） |
| `next_step` | string | 次のステップへのヒント |

**フォールバック処理**:

| 条件 | 対応 |
|---|---|
| JSONパースエラー | リトライ（最大3回） |
| 必須フィールド欠落 | リトライ（最大3回） |
| 3回失敗 | 手動評価キューに追加、講師にメール通知 |
| 手動評価キュー | 講師がWebアプリ管理画面から再評価 |

> **セキュリティ**: 提出内容は「ユーザー入力」として隔離し、プロンプトインジェクション対策を施す。

### 5.6 アクセス制御設計（RBAC/RLS）

> [!IMPORTANT]
> 外部混在・多社運用に対応するため、Row Level Security（RLS）を実装

**ロール定義**:

| ロール | アクセス範囲 | 主な権限 |
|---|---|---|
| 受講者 | 自分のデータのみ | 課題提出、進捗確認、評価結果閲覧 |
| 企業管理者（任意） | 自社受講者のみ | 自社進捗確認、エクスポート |
| 講師 | 全受講者データ | 評価確認、再評価、全体講評 |
| 運営管理者 | 全データ | ユーザー管理、コホート管理、監査 |

**RLS実装方針**:
- DB層でRow Level Securityを実装（PostgreSQL RLS等）
- `user_id` / `tenant_id` / `cohort_id` でデータ分離
- APIレイヤーでも二重チェック

### 5.7 視聴チェックイン（助成金対応）

> [!IMPORTANT]
> 厚労省助成金申請には受講証跡（視聴ログ）が必要。**Webアプリ内チェックイン**で取得。

**方式**: Webアプリ内チェックイン（セッション単位）

- 動画視聴後、受講者がWebアプリで「視聴完了」ボタンをクリック
- チェックインがDBに記録され、助成金申請の証跡となる
- 未チェックイン者にはリマインドメール（週次自動送信）

**チェックイン記録項目**:

| 項目 | 内容 |
|---|---|
| user_id | 受講者ID |
| session_id | Session 1-13 |
| checked_in_at | チェックイン日時（タイムスタンプ） |
| ip_address | IPアドレス（監査用） |

**視聴完了判定**:
- 1セッション=1回のチェックインで「視聴完了」とみなす
- DBで視聴完了状況を集計し、ダッシュボードに表示

### 5.8 受講者規約（自動評価）

> [!IMPORTANT]
> 受講者向けに以下を明文化し、**Webアプリ初回ログイン時に同意を取得**

**規約内容**:

1. **自動評価の性質**:
   - 課題評価はGemini APIによるLLM自動評価を使用
   - 評価精度には一定の誤差が含まれる可能性がある
   - 評価結果は学習指針として参考にしていただくもの

2. **入力禁止情報**:
   - 社外秘・機密情報
   - 個人情報（氏名、連絡先、マイナンバー等）
   - 顧客情報・取引先情報
   - パスワード・認証情報

3. **修了判定**:
   - LLMスコアは参考値であり、修了判定には使用しない
   - 修了判定は「必須課題13件100%提出」で決定

### 5.9 データ保持・削除・監査

> [!IMPORTANT]
> 企業導入・助成金監査を想定したデータ管理

| データ種別 | 保持期間 | 削除方法 |
|---|---|---|
| 受講者情報 | 修了後5年 | 期限到来後に自動削除（論理削除→物理削除） |
| 課題提出物 | 修了後5年 | 同上 |
| 評価結果 | 修了後5年 | 同上 |
| 視聴チェックイン | 修了後5年 | 同上（助成金監査対応） |
| 監査ログ | 7年 | 法定保存期間後に削除 |

**エクスポート機能**:
- 管理者が助成金申請用データをCSVエクスポート可能
- 受講者名簿、視聴記録、課題提出記録、修了判定を出力

---

## 6. 要件管理プロセス

- **要件変更手順**:
  1. 変更要求を課題管理ツールに起票
  2. 影響分析（スケジュール・コスト・品質）
  3. PgM承認後、要件定義書を更新
  4. 関連ドキュメント（WBS、テスト計画等）を連動更新
- **トレーサビリティ**:
  - 要件ID（BR/FR）→ WBSタスク → テストケース の紐付けを管理
- **承認プロセス**:
  - 要件追加・変更はPgM承認必須
  - 重大変更（予算10%超、スケジュール2週間超の影響）はスポンサー承認

---

## 7. 承認

| 役割 | 氏名 | 承認日 |
|---|---|---|
| プロジェクトスポンサー | - | - |
| プログラムマネージャー | AI-PgM | 2025-12-29 |
| 業務責任者 | 井戸 | - |

---

## 次のステップ

1. **アプリ仕様書（app_spec.md）の作成** - 画面一覧・状態遷移・ワイヤーフレーム
2. **DB設計書（db_schema.md）の作成** - テーブル設計・RLS方針
3. **API仕様書（api_spec.md）の作成** - エンドポイント・I/O定義
4. **テスト計画書の更新** - Webアプリ・Gemini API・RBAC観点の追加
5. **Webアプリ開発着手** - MVP実装
