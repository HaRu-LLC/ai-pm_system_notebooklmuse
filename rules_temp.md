# Antigravity Rules / Workflows ＆ Claude Code Skills 設計レポート（v2：あなたの回答反映版）

---

## 1. 要約（今回の追加インプットの反映）
- 1) 過去資料は存在するが、再利用できる「標準テンプレ」は未整備。  
  → まず“テンプレ抽出・標準化の仕組み”を Workflows/Skills として組み込み、以後は自動で揃う状態を作るのが最短。
- 2) Antigravity のターミナル自動実行は、おそらく Off 運用が適切。  
  → 安全性と予測可能性を優先し、AIは「コマンド提案＋理由＋期待結果」までに留め、実行は人間が行うプロトコルにする。
- 3) 診断サイトはログ保存しない一方、シミュレーションゲームはメールアドレス取得。  
  → “ログ無し”と “PII（メール）取得”が同居するため、Rules/Workflows に「データ分類・同意・保存・マスキング・保持期間」の設計を明示的に組み込む必要がある。

---

## 2. 提案・アイデア提示（ステップ・バイ・ステップで一括実装）

### 第1ステップ：現状分析の強化（テンプレ不在を“仕組み”で解決）
結論：テンプレが無い場合、AI運用がブレます。ブレを止める最短は「過去資料→標準テンプレ→チェックリスト」のパイプライン化です。

- 方針：過去資料を“教師データ”として、以下を生成して資産化
  1) 文体・構造ガイド（Style Guide）
  2) ドキュメント種別別テンプレ（提案書/稟議/議事録/PRD/メール）
  3) 章ごとの定型文スニペット（言い回しの統一）
  4) 抜け漏れ検査チェックリスト（DoD）

- 実装：Antigravity Workflows と Claude Skills の両方に「テンプレ抽出（Template Mining）」を作る  
  → “テンプレが無い”状態を最初の1回だけで終わらせ、以後は自動で揃う状態にします。

---

### 第2ステップ：3〜5種類の戦略オプション比較（運用アーキの選択肢）
あなたのケースでは、次の運用形が現実的です。

**Option A（推奨）：「Rules最小＋Workflow厚め」**
- Rules：共通規範（出力構造/品質/安全/データ）だけに絞る
- Workflows：ドキュメント生成・テンプレ抽出・プライバシーレビューを工程化
- メリット：ブレが少なく、更新が容易。Off運用と相性が良い。

**Option B：「Rules厚め」**
- Rules：細かなテンプレや手順までRulesに押し込む
- メリット：常時適用で強いが、衝突・過剰拘束が起きやすい（テンプレ未整備の状況だと特に）

**Option C：「Skills中心（Claude）→ Workflowsへ移植」**
- まず Claude Skills を整備して“型”を確立し、その後 Antigravity Workflows に移植
- メリット：段階的開示（progressive disclosure）の恩恵が大きい
- デメリット：立ち上げが二段階になる

結論：いまは **Option A** を採用し、並走で **Option C** を小さく始めるのが最も堅いです。

---

### 第3ステップ：特定の戦略選定基準（あなた向けの最適解）
- 主用途がビジネス文書で、テンプレ未整備：  
  → **テンプレ抽出を最優先**（Workflow/Skillを先に作る）
- ターミナルは Off 想定：  
  → **AIは提案と検証設計まで**。実行は人間（安全・説明責任・事故防止）
- メール取得がある：  
  → **PII設計（同意・最小化・マスキング・保持期間・削除）をRules化**し、メールを含むログやURL露出を避ける工程をWorkflow化

---

### 第4ステップ：実行計画（短・中・長期）
**短期（当日〜2日）**
1) Antigravity Rules v2 を導入（下のコピペ素材）
2) Workflows（doc/テンプレ抽出/プライバシー/シミュレーション）を導入
3) ./agent 構造（skills/templates/registry）を作る

**中期（1〜2週間）**
1) 過去資料を3〜10件投入し、Style Guide とテンプレを確定
2) “文書の型”が固まったら、Claude Skills を3本（doc/pm/privacy）から実装
3) Skills → Workflows の変換をregistryで管理（命名と対応表）

**長期（1〜2ヶ月）**
1) 診断サイト/ゲームの工程もテンプレ化（テスト、運用、セキュリティ）
2) 収集メールの運用（配信/退会/削除/監査）まで含めて定着

---

### 第5ステップ：リスク評価とリスク軽減策
- リスク：テンプレ抽出が曖昧で、結局ブレる  
  → 対策：抽出Workflowで「共通要素（章立て/語尾/表現禁止/証拠レベル）」を明文化し、DoDチェックを通す
- リスク：Off運用で開発が遅くなる  
  → 対策：Workflow内で「コマンド提案をコピペ可能」にし、期待結果・ロールバック案まで付けて手戻りを減らす
- リスク：メール取得に伴うプライバシー事故（ログ露出、URLパラメータ露出、誤送信）  
  → 対策：Rulesで禁止（URLに載せない、ログマスク、保存最小化、保持期間、削除手順）＋Workflowで設計レビュー必須化  
  ※法令適合は地域・用途で異なるため、必要に応じて法務/専門家レビューを前提にする（一般的ベストプラクティスとして提示）。

---

## 3. Antigravity：Rules（v2 コピペ用）

### 3.1 目的
- “文書品質の再現性”を最優先（テンプレ未整備を補う）
- ターミナル Off 前提で事故をゼロ化
- メール取得（PII）を安全に扱う

---

### 3.2 GEMINI / Rules 本文（そのまま貼る用）
以下は「Antigravity の Rules」に貼る想定です。運用上は複数ファイルに分割推奨ですが、まずは一括でOKです。

【RULES v2（貼り付け用）】

1) 出力構造（固定）
- 常に「要約 → 提案（ステップ・バイ・ステップ） → 次の深掘り質問」で出力する。
- 曖昧でも最善の仮説で前に進み、必要な前提だけを最後に質問する。

2) 文書の品質規格（テンプレ未整備前提）
- 文書は原則「Executive Summary / Context / Options / Recommendation / Execution Plan / Risks」で構成する。
- “根拠レベル”を明示する（確定情報・推定・仮説を区別）。
- 文章トーンはビジネス文書として簡潔・断定しすぎない（仮説は仮説と明記）。
- テンプレが無い場合は、過去資料の共通構造を抽出して暫定テンプレを提案し、それに沿って作成する。

3) テンプレ資産化（必須プロセス）
- 新規ドキュメント種別を作るときは、まず「章立て」「定型文」「禁止表現」「DoDチェック」を抽出し、テンプレとして再利用可能な形に整える。

4) ターミナル実行（Off前提プロトコル）
- 私（AI）はターミナルコマンドを自動実行しない。
- 必要な場合は「コマンド」「理由」「期待結果」「失敗時の確認手順」「ロールバック案」をセットで提示し、ユーザー実行を前提にする。
- 破壊的操作（削除、強制push、大量置換、権限変更等）は必ず事前にリスク説明し、承認を得る。

5) データ・プライバシー規格（診断サイト：ログ無し／ゲーム：メール取得）
- データ分類を行う：公開情報 / 業務機密 / 個人情報（PII: メールなど）。
- PIIをURLクエリやログに含めない（フォーム送信はPOST、ログはマスク）。
- 収集目的、同意（オプトイン）、保持期間、削除手順を設計に含める。
- 診断サイトは「サーバログ保存無し」を前提に、解析用の識別子も最小化する。
- シミュレーションゲームでメールを取得する場合、目的（連絡/アカウント/結果送付/マーケ等）を明確化し、必要最小のみ保存する（可能ならハッシュ化や分離保管も検討）。

6) ルーティング（Workflow優先）
- 依頼を受けたら、最適なWorkflow候補を提示し、必要なら /workflow の実行を提案する。
- 例：
  - 提案書/稟議/PRD/議事録 → /doc_* 系
  - テンプレが無い → /bootstrap_template_library
  - 診断サイト → /build_diagnostic_site_no_logs
  - ゲーム＋メール取得 → /build_simulation_game_email + /privacy_review_email_collection

【RULES v2 ここまで】

---

## 4. Antigravity：Workflows（v2 コピペ用）

> ここでは「Workflow本文」を提示します。  
> ファイル名＝コマンド名に揃える運用を推奨（例：bootstrap_template_library.md → /bootstrap_template_library）。

---

### 4.1 /bootstrap_template_library（過去資料からテンプレ抽出：最優先）
目的：テンプレ未整備を“1回で終わらせる”。

入力（ユーザーに依頼するもの）：
- 過去資料 3〜10件（同じ用途のものを優先）
- 対象の文書種別（例：提案書、稟議、議事録、PRD、週次報告）
- 読者（役員/部長/現場）

手順：
1) 各資料の章立てを抽出し、共通パターン（最頻出）を見つける
2) 各章の役割（意思決定に必要な情報）を定義する
3) “定型文スニペット”を章ごとに抽出（冒頭文、結論文、注意書き）
4) 禁止・注意表現（曖昧語、過度な断定、根拠なき数値など）を抽出
5) DoDチェック（抜け漏れ検査表）を作る
6) 成果物：
   - STYLE_GUIDE.md（文体・トーン・表現）
   - TEMPLATE_<doc-type>.md（章立てテンプレ）
   - CHECKLIST_<doc-type>.md（DoD）

---

### 4.2 /doc_from_examples（過去資料の“型”で新規作成）
入力：
- 参考資料（@で添付）
- 新規テーマ（何を決めたいか）

手順：
1) 参考資料の章立てを抽出し、同じ型にマッピング
2) 新規テーマの情報を不足分は仮説で補う（仮説は仮説と明記）
3) DoDチェックを通す
成果物：
- 新規文書（参考資料の型に準拠）
- “追加で欲しい情報”の質問（最後に）

---

### 4.3 /privacy_review_email_collection（メール取得がある機能の設計レビュー）
目的：メール取得に伴う事故（ログ露出・同意不足・保持不明）を潰す。

入力：
- 取得するメールの用途（結果送付/ログイン/連絡/マーケ等）
- 保存先（DB/外部サービス）
- 保持期間（未定なら仮案）

手順（チェックリスト化して実行）：
1) 目的の正当化：メールが必須か？代替（匿名ID等）は？
2) 同意：オプトインの文言、プライバシー通知の場所、二重同意が必要か
3) 取得最小化：フォーム項目は最小にできるか
4) 露出経路遮断：URLに載せない、ログマスク、エラー通知に載せない
5) 保存と分離：メールは分離保管・暗号化・アクセス制御
6) 保持と削除：保持期間、削除手順、ユーザーからの削除依頼導線
7) インシデント前提：漏えい時の対応手順（最小限の記述で可）
成果物：
- “メール取得設計メモ”（上記7項目を埋めたもの）
- 実装上の注意点（ログ、URL、POST、マスク）

---

### 4.4 /build_diagnostic_site_no_logs（診断サイト：ログ保存しない前提で仕様→実装計画）
入力：
- 診断テーマ、入力項目、診断ロジック
- 公開範囲、利用規約/免責の有無

手順：
1) UX設計（入力→結果→共有有無）
2) データ方針：サーバログ/アクセス解析/識別子の扱い（“保存しない”を実装レベルに落とす）
3) MVP仕様（画面、入力検証、結果表示）
4) テスト観点（機能・セキュリティ・負荷の最小）
成果物：
- 仕様（画面・項目・結果）
- 実装タスク分解
- “ログ無し”実装チェック（PII混入防止）

---

### 4.5 /build_simulation_game_email（ゲーム：メール取得ありで設計→実装計画）
入力：
- ゲームの目的、勝利条件、状態変数、アクション
- メール取得の目的（結果送付/アカウント/連絡 等）

手順：
1) ゲームループ定義（状態→意思決定→遷移→報酬）
2) パラメータ一覧とバランス指標（平均ターン、クリア率等）
3) メール取得設計（/privacy_review_email_collection を内包してレビュー）
4) 実装計画（ロジック分離、テスト、再現性のためのシード設計）
成果物：
- 仕様（状態変数表、遷移、報酬）
- メール取得設計メモ
- タスクとテスト観点

---

### 4.6 /skill_factory（./agent の Skills を生成するための仕様化）
入力：
- Skill 名、想定ユーザー発話（トリガー語）、成果物、禁止事項

手順：
1) name / description を確定（トリガー精度最優先）
2) SKILL.md を生成（最小手順＋成果物テンプレ＋DoD）
3) 詳細は REFERENCE / templates に分離
成果物：
- ./agent/skills/.../SKILL.md の草案
- 必要な追加ファイル案

---

## 5. ./agent と Claude Code：Skills 設計（v2）

### 5.1 推奨ディレクトリ（正本は ./agent）
- agent/
  - skills/
    - business/
    - pm/
    - engineering/
    - meta/
  - templates/
    - docs/
    - pm/
    - engineering/
  - registry.md（Skills/Workflows 対応表）
  - CLAUDE.md（Claude Code の行動規範）

運用原則：
- Skills は「小さく・単機能・トリガー明確」にする
- “テンプレ抽出”と “プライバシーレビュー” を最初に作る（全作業の品質が上がる）

---

### 5.2 registry.md（Skills ⇄ Workflows 対応表：雛形）
- template-miner  ⇄ /bootstrap_template_library
- doc-from-examples ⇄ /doc_from_examples
- privacy-email-review ⇄ /privacy_review_email_collection
- sim-game-builder-email ⇄ /build_simulation_game_email
- diagnostic-site-no-logs ⇄ /build_diagnostic_site_no_logs

---

### 5.3 SKILL.md テンプレ（そのまま使える雛形）
以下は Claude Code の Skill フォルダに置く想定です。

(1) ./agent/skills/meta/template-miner/SKILL.md
---
name: template-miner
description: 過去の社内資料から文書テンプレ（章立て・定型文・チェックリスト）を抽出して標準化する。提案書、稟議、議事録、PRDのテンプレが無いときに使う。
---
目的
- 過去資料を教師データにして、再利用可能なテンプレと品質チェックを生成する。

入力で最初に聞くこと
- 対象文書種別（例：提案書/稟議/PRD/議事録）
- 参考資料（複数）と読者（役員/部長/現場）

手順
1. 参考資料の章立てを抽出し、共通構造を定義する
2. 各章の“意思決定に必要な情報”を定義する
3. 章ごとの定型文スニペットを抽出する
4. 禁止・注意表現を抽出する
5. DoDチェックリストを作る
6. STYLE_GUIDE.md / TEMPLATE_*.md / CHECKLIST_*.md を出力する

成果物テンプレ
- STYLE_GUIDE.md
- TEMPLATE_<doc-type>.md
- CHECKLIST_<doc-type>.md

検証（完了条件）
- テンプレに従えば同品質の文書が再現できる状態になっている
- チェックリストが“抜け漏れ”を検出できる

(2) ./agent/skills/business/doc-from-examples/SKILL.md
---
name: doc-from-examples
description: 過去資料の型に合わせて新しいビジネス文書を作る。テンプレが未整備でも品質を揃えたいときに使う。
---
目的
- 過去資料の構造と文体で新規文書を生成し、社内の“らしさ”を担保する。

入力で最初に聞くこと
- 参考資料（@添付）
- 誰が意思決定するか、何を決めたいか

手順
1. 参考資料の章立てとトーンを抽出する
2. 新規テーマの情報を章ごとに埋める
3. 不足情報は仮説で補完し、仮説であることを明記する
4. DoDチェックを通す
5. 追加で必要な情報を質問する

(3) ./agent/skills/pm/privacy-email-review/SKILL.md
---
name: privacy-email-review
description: メールアドレス取得を伴う機能の設計レビューを行う。ログ露出、同意、保持期間、削除手順の不備を防ぐ。
---
目的
- メール（PII）取得で起きがちな事故を事前に防ぐ。

入力で最初に聞くこと
- メール取得の目的（結果送付/ログイン/連絡/マーケ等）
- 保存先、保持期間、削除要件

手順
1. 目的の正当化（本当に必要か、代替はないか）
2. 同意（UI文言、通知、オプトイン、二重同意の要否）
3. 露出経路遮断（URL、ログ、エラー、通知）
4. 保存と保護（分離保管、暗号化、アクセス制御）
5. 保持と削除（保持期間、削除導線、削除手順）
6. 実装チェック（POST、ログマスク、DBスキーマの注意）
成果物
- メール取得設計メモ（上記項目を埋めたもの）
- 実装上の注意点リスト

---

## 6. CLAUDE.md（v2：Off運用＋メール取得を反映）
以下をあなたのリポジトリの CLAUDE.md に採用してください（必要なら Gemini に生成させる）。

# CLAUDE.md（v2）
- このリポジトリでは Skills を ./agent/skills を正本として管理する
- Skill は1フォルダ=1 Skill、必ず SKILL.md を含む（YAML: name/description 必須）
- テンプレが無い場合は template-miner を使って標準テンプレを生成する
- 個人情報（PII: メール等）を扱う場合は privacy-email-review を必ず通す
- ログ/URL/通知にPIIを載せない。フォーム送信はPOST。ログはマスク。
- ターミナル操作は破壊的操作を避け、実行前に目的・期待結果・失敗時手順・ロールバック案を明示する
